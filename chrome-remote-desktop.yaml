# Installation steps for Chrome Remote Desktop.
# https://cloud.google.com/solutions/chrome-desktop-remote-on-compute-engine
- name: install chrome remote desktop, chrome
  become: yes
  apt:
    deb: https://dl.google.com/linux/direct/chrome-remote-desktop_current_amd64.deb
- name: set 2d cinnamon
  become: yes
  copy:
    content: "exec /etc/X11/Xsession /usr/bin/cinnamon-session-cinnamon2d"
    dest: /etc/chrome-remote-desktop-session

# Prevent screensaver from getting enabled (to prevent getting locked
# out on machines with no password set up).
- name: disable screensaver to not get locked out of VM (with no password)
  block:
    - name: disable locking on screensaver
      dconf:
        key: /org/cinnamon/desktop/screensaver/lock-enabled
        value: "false"
    - name: disable automatic screensaver when idle
      dconf:
        key: /org/cinnamon/desktop/screensaver/session/idle-delay
        value: "uint32 0"
    - name: disable locking on suspend
      dconf:
        key: /org/cinnamon/settings-daemon/plugins/power/lock-on-suspend
        value: "false"

- name: disable desktop effects (for faster remote desktop)
  block:
    - name: disable desktop effects
      dconf:
        key: /org/cinnamon/desktop-effects
        value: "false"
    - dconf:
        key: /org/cinnamon/desktop-effects-close-effect
        value: "'traditional'"
    - dconf:
        key: /org/cinnamon/desktop-effects-map-effect
        value: "'traditional'"
    - dconf:
        key: /org/cinnamon/desktop-effects-maximize-effect
        value: "'none'"
    - dconf:
        key: /org/cinnamon/desktop-effects-minimize-effect
        value: "'traditional'"
    - dconf:
        key: /org/cinnamon/desktop-effects-tile-effect
        value: "'none'"
    - dconf:
        key: /org/cinnamon/desktop-effects-unmaximize-effect
        value: "'none'"
    - dconf:
        key: /org/cinnamon/desktop-effects-on-dialogs
        value: "false"
    - dconf:
        key: /org/cinnamon/desktop-effects-on-menus
        value: "false"
    - dconf:
        key: /org/cinnamon/enable-vfade
        value: "false"
    - dconf:
        key: /org/cinnamon/startup-animation
        value: "false"
# fails with "no such service"
#- name: disable display manager
#  systemd:
#    name: lightdm.service
#    enabled: no
