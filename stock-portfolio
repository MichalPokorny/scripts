#!/usr/bin/ruby

require_relative 'lib/finance/stocks'

class Main
	def initialize

		@raw_mode = false
		@verbose_table_mode = false
	end

	def parse_argv(argv)
		until argv.empty?
			flag = argv.shift

			case flag
			when '--raw'
				@raw_mode = true
			when '--verbose_table'
				@verbose_table_mode = true
			else
				raise "Unknown flag: #{flag}"
			end
		end
	end

	def main(argv)
		parse_argv(argv)
		@report = Prvak::Finance::Stocks::StatusReport.build

		if @verbose_table_mode
			puts @report.terminal_table
		end

		if @raw_mode
			puts @report.total_value_czk
		else
			puts '$%.2f + %d Kč (%d Kč)' % [
				@report.cash_usd + @report.stock_value_usd,
				@report.cash_czk,
				@report.total_value_czk
			]
		end
	end
end

Main.new.main(ARGV)
